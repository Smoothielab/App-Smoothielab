<script>
  // --- CONFIGURACIÃ“N DE NERTAIL (VERIFICADA) ---
  const URL_BASE_NERTAIL = "https://near.tl/sm/EjNeimTXT"; 
  const PARAM_NOMBRE = "nombre";
  const PARAM_TELEFONO = "telefono"; 
  // -----------------------------------------------------------
  
  // 1. REGISTRAR PWA (para que sea instalable)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
  }

  // 2. GESTIÃ“N DEL PERFIL
  document.addEventListener('DOMContentLoaded', () => {
    const perfilGuardado = localStorage.getItem('perfilSmoothie');
    
    // Establecemos la URL de destino por defecto a Nertail
    let destinationURL = URL_BASE_NERTAIL; 
    let datos = {}; // Objeto para guardar datos temporalmente
    
    if (perfilGuardado) {
      // ðŸŸ¢ CLIENTE FRECUENTE: RedirecciÃ³n rÃ¡pida con datos.
      datos = JSON.parse(perfilGuardado);
      
      // Construir la URL con los datos guardados
      destinationURL = `${URL_BASE_NERTAIL}?${PARAM_NOMBRE}=${encodeURIComponent(datos.nombre)}&${PARAM_TELEFONO}=${encodeURIComponent(datos.telefono)}`;
      
      // Actualizar el mensaje antes de redirigir
      document.querySelector('h1').innerText = `Â¡Hola de nuevo, ${datos.nombre}!`;
      document.querySelector('p').innerText = 'Redirigiendo con tu perfil listo...';

    } else {
      // ðŸŸ¡ CLIENTE NUEVO: Solicitar datos para guardar perfil por primera vez.
      
      const formPromptNombre = 'Â¡Bienvenido! Para guardar tu perfil y que la prÃ³xima vez sea mÃ¡s rÃ¡pido, dinos tu nombre:';
      const nombre = prompt(formPromptNombre);
      
      if (nombre) {
          const telefono = prompt(`Hola ${nombre}, ahora dinos tu telÃ©fono (solo nÃºmeros):`);
          
          if (telefono) {
              // Guardar perfil y construir URL de pre-llenado
              datos = { nombre: nombre, telefono: telefono };
              localStorage.setItem('perfilSmoothie', JSON.stringify(datos));
              
              // El destino serÃ¡ el link de Nertail con los datos pre-llenados
              destinationURL = `${URL_BASE_NERTAIL}?${PARAM_NOMBRE}=${encodeURIComponent(nombre)}&${PARAM_TELEFONO}=${encodeURIComponent(telefono)}`;
              alert('Â¡Perfil guardado! SerÃ¡s redirigido al menÃº.');
              
          }
          // Si el cliente pone nombre pero cancela telÃ©fono, 'destinationURL' sigue siendo la URL base.
          
      } 
      // Si el cliente cancela el nombre, 'destinationURL' sigue siendo la URL base.
      
      // Opcional: Cambiar el mensaje para nuevos usuarios
      if (!nombre || !telefono) {
          document.querySelector('h1').innerText = `Â¡Bienvenido!`;
          document.querySelector('p').innerText = 'Redirigiendo al menÃº de pedidos...';
      }
    }

    // âž¡ï¸ REDIRECCIÃ“N GARANTIZADA: Esta lÃ­nea se ejecuta en TODOS los casos.
    setTimeout(() => {
       window.location.replace(destinationURL);
    }, 500); // 0.5 segundo de retraso.
  });
</script>
