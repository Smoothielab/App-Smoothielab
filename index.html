<script>
  // --- CONFIGURACI√ìN DE NERTAIL ---
  const URL_BASE_NERTAIL = "https://near.tl/sm/EjNeimTXT"; 
  const PARAM_NOMBRE = "nombre";
  const PARAM_TELEFONO = "telefono"; 
  // -----------------------------------------------------------
  
  // 1. REGISTRAR PWA
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
  }

  // 2. GESTI√ìN DEL PERFIL
  
  const perfilGuardado = localStorage.getItem('perfilSmoothie');
  let destinationURL = URL_BASE_NERTAIL; 
  let datos = {}; 
  
  if (perfilGuardado) {
    // üü¢ CLIENTE FRECUENTE: La redirecci√≥n debe ser instant√°nea
    datos = JSON.parse(perfilGuardado);
    destinationURL = `${URL_BASE_NERTAIL}?${PARAM_NOMBRE}=${encodeURIComponent(datos.nombre)}&${PARAM_TELEFONO}=${encodeURIComponent(datos.telefono)}`;
    
    document.querySelector('h1').innerText = `¬°Hola de nuevo, ${datos.nombre}!`;
    document.querySelector('p').innerText = 'Redirigiendo con tu perfil listo...';

  } else {
    // üü° CLIENTE NUEVO
    const nombre = prompt('¬°Bienvenido! Para guardar tu perfil y que la pr√≥xima vez sea m√°s r√°pido, dinos tu nombre:');
    
    if (nombre) {
        const telefono = prompt(`Hola ${nombre}, ahora dinos tu tel√©fono (solo n√∫meros):`);
        
        if (telefono) {
            datos = { nombre: nombre, telefono: telefono };
            localStorage.setItem('perfilSmoothie', JSON.stringify(datos));
            destinationURL = `${URL_BASE_NERTAIL}?${PARAM_NOMBRE}=${encodeURIComponent(nombre)}&${PARAM_TELEFONO}=${encodeURIComponent(telefono)}`;
            alert('¬°Perfil guardado! Ser√°s redirigido al men√∫.');
        } 
    } 
    
    if (!nombre || !telefono) {
        document.querySelector('h1').innerText = `¬°Bienvenido!`;
        document.querySelector('p').innerText = 'Redirigiendo al men√∫ de pedidos...';
    }
  }

  // ‚û°Ô∏è REDIRECCI√ìN FORZADA CON JAVASCRIPT
  // Usamos .href = en lugar de .replace()
  window.location.href = destinationURL; 

</script>
