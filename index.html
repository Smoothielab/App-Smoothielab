<script>
  // --- CONFIGURACI√ìN DE NERTAIL ---
  const URL_BASE_NERTAIL = "https://near.tl/sm/EjNeimTXT"; 
  const PARAM_NOMBRE = "nombre";
  const PARAM_TELEFONO = "telefono"; 
  // -----------------------------------------------------------
  
  // 1. REGISTRAR PWA (para que sea instalable)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
  }

  // 2. GESTI√ìN DEL PERFIL (SIN ESPERAS AS√çNCRONAS)
  
  const perfilGuardado = localStorage.getItem('perfilSmoothie');
  let destinationURL = URL_BASE_NERTAIL; // Por defecto, redirigir a Nertail base
  let datos = {}; 
  
  if (perfilGuardado) {
    // üü¢ CLIENTE FRECUENTE
    datos = JSON.parse(perfilGuardado);
    
    // Construir la URL con los datos guardados
    destinationURL = `${URL_BASE_NERTAIL}?${PARAM_NOMBRE}=${encodeURIComponent(datos.nombre)}&${PARAM_TELEFONO}=${encodeURIComponent(datos.telefono)}`;
    
    // Actualizar mensaje (esto ocurre justo antes de la redirecci√≥n)
    document.querySelector('h1').innerText = `¬°Hola de nuevo, ${datos.nombre}!`;
    document.querySelector('p').innerText = 'Redirigiendo con tu perfil listo...';

  } else {
    // üü° CLIENTE NUEVO (Si cancela, la URL sigue siendo la base de Nertail)
    
    const nombre = prompt('¬°Bienvenido! Para guardar tu perfil y que la pr√≥xima vez sea m√°s r√°pido, dinos tu nombre:');
    
    if (nombre) {
        const telefono = prompt(`Hola ${nombre}, ahora dinos tu tel√©fono (solo n√∫meros):`);
        
        if (telefono) {
            // Guardar perfil y construir URL de pre-llenado
            datos = { nombre: nombre, telefono: telefono };
            localStorage.setItem('perfilSmoothie', JSON.stringify(datos));
            destinationURL = `${URL_BASE_NERTAIL}?${PARAM_NOMBRE}=${encodeURIComponent(nombre)}&${PARAM_TELEFONO}=${encodeURIComponent(telefono)}`;
            alert('¬°Perfil guardado! Ser√°s redirigido al men√∫.');
        } 
    } 
    
    // Actualizar mensaje para nuevos usuarios
    if (!nombre || !telefono) {
        document.querySelector('h1').innerText = `¬°Bienvenido!`;
        document.querySelector('p').innerText = 'Redirigiendo al men√∫ de pedidos...';
    }
  }

  // ‚û°Ô∏è REDIRECCI√ìN INMEDIATA Y GARANTIZADA
  // Esta l√≠nea se ejecuta inmediatamente despu√©s de que termina la l√≥gica anterior.
  window.location.replace(destinationURL); 

</script>
